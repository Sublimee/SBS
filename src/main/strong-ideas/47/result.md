1. Обозревайте не более 200-400 строк кода за раз.

Если PR слишком большой, то я либо прошу разбить его на несколько независимых и более компактных, либо подхожу к обзору такого PR в несколько подходов.

2. Придерживайтесь темпа не более 300-500 строк кода/час.

Я специально никогда не замерял темп и трачу столько времени на обзор, чтобы у меня не осталось вопросов ни с точки зрения кодирования, ни с точки зрения дизайна/аналитики. Если сервис/домен знакомы, то темп растет, иначе -- значительно падает и требует нескольких подходов для осознания происходящего.

3. Отведите достаточно времени для вдумчивого и неспешного просмотра, однако не более 60-90 минут.

Если нужно относительно срочно отсмотреть множество PR, то я сделаю это вдумчиво лишь для части PR в течение специально для этой активности выделенных 45-60 минут, остальные PR отложу. В это время на обзор PR могут подключиться другие участники команды (благо у нас их много). На следующей итерации я выполню обзор оставшихся PR.

4. Авторов кода следует принуждать к комментированию/документированию кода до начала code review.

Я обычно даю качественное описание выполненной доработки и по возможности обогащаю это описание скриншотами и ссылками на документацию.

Если есть участки кода, на которые нужно обратить особое внимание, чтобы выделить их из остальной обвязки, я оставляю комментарии на уровне платформы (у нас Bitbucket).

5. Устанавливайте количественно измеряемые цели в обзорах кода и фиксируйте метрики, чтобы улучшать этот процесс.

Сейчас уже отслеживаются внутренние метрики: количество Approved, Need Works, комментариев, оставленных разработчиками. В скором времени будет отслеживаться время, потраченное на ревью (время между открытием PR и произведенными над ним действиями).

Также отслеживается внешняя метрика VOC (voice of client), которая отвечает за удовлетворенность клиента сервисом.

6. Чек-листы существенно улучшают результаты как для программистов, так и для инспекторов.

Чек-листов в явном виде у нас нет, но есть style guides, которые выверены с учетом опыта написания и ревью кода. Код у нас в большинстве своем однотипный от сервиса к сервису, что приводит к усреднению знаний разработчиков о проблемных местах с течением времени. Хорошо было бы эти проблемные места зафиксировать списком явно.

7. Убедитесь, что баги действительно исправлены!

Bitbucket предоставляет возможность обсудить комментарий и выполнить его Resolve, если вопрос исчерпан. В этом смысле был бы правилен более строгий подход: вмержить PR не получится, пока Resolve всех комментариев не будет выполнен их авторами.

8. Формированию правильной культуры обзоров кода, когда поиск дефектов методами пристального взгляда воспринимается положительно всеми сторонами, должны способствовать прежде всего менеджеры проектов.

Все сказанное в пункте верно для наших команд. Ревью проходит в доброжелательной атмосфере, даже если на одном PR создано уже более 100 тредов с комментариями).

9. Остерегайтесь эффекта "Большого брата".

Несмотря на то, что мы собираем метрики активности разработчиков на ревью, санкции могут быть применены только к злостным нарушителя дисциплины, которые не участвуют в обзоре кода или делают это формально. Мы ценим продуктивность коллег в процессах обзора кода, но это никак негативным образом не влияет на коллег, чьи PR обозревают.

10. Эффект эго: сделайте хотя бы небольшой обзор кода, даже если у вас нет времени просмотреть весь код.

Такой эффект точно испытываю я, когда ставлю PR. Я дополнительно в платформе (Bitbucket) просматриваю еще раз весь код, стараясь тем самым сократить количество возможных вопросов/комментариев от коллег.

Регулярно мы не подсвечиваем успехи некоторых разработчиков, хотя собираемая на данный статистика по активности может быть для этого эффективно использована.

11. Облегчённые обзоры кода всё равно остаются эффективны, практичны и полезны при поиске ошибок.

Чтобы быстрее и качественнее отсмотреть код, я часто использую IDE для лучшей навигации по коду. К сожалению Bitbucket не является настолько гибким решением. Для облегчения процесса ревью также используются предварительно проходящие задачи линтера, статического анализатора, сканеров безопасности и анализ с помощью ИИ (пока бесполезный).

# Вывод

В целом мы стараемся придерживаться указанных выше рекомендаций. В каждом из этих пунктов есть разумное зерно. 

Однако мы столкнулись с проблемой, что некоторые разработчики практически не вовлечены в процесс ревью PR: уделяют ревью мало времени в целом и каждому PR в частности. Даже собираемые метрики по активности на PR не всегда способны изменить ситуацию в лучшую сторону: разработчик начинает формально попадать в зеленую зону по метрикам, при этом качество ревью (нахождение багов) не улучшается (оставляются комментарии уровня линтера). Почему так происходит: участие в ревью PR -- дополнительная нагрузка, которая никак не отразится на доходе / качестве собственного кода (в моменте). Логика примерно такая: "Лучше запилю новую фичу, по которой у меня сроки есть вполне конкретные, чем потрачу время на ревью кода коллег". Я не слышал, чтобы кого-то увольняли за низкую вовлеченность в ревью PR, поэтому безнаказанность перерастает в злоупотребление некоторыми 

Также примерно раз в квартал мы обсуждаем, как можно поднять качество ревью кода. В скором времени мы должны получить механизм, который будет отслеживать время, проведенное за ревью. Возможно, статистика будет не очень точной, но явных лодырей отыскать позволит. Хотя, кажется, что и имеющейся статистики по активности должно быть более чем достаточно для применения соответствующих мер. К сожалению, без кнута, мы пока не видим способа, как сделать процесс ревью более качественным.
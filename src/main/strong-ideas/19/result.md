На последнем собеседовании в Yandex была задача спроектировать систему отзывов для Маркета. По условию у каждого товара может быть несколько десятков/сотен отзывов. Отзывы оставляют пользователи. Список отзывов меняется на несколько порядков реже, чем запрашивается для отображения.

В качестве возможного решения можно было бы предложить классическую схему с тремя таблицами в РСУБД: Пользователи, Товары и Отзывы, где каждый отзыв содержал бы уникальный идентификатор пользователя и товара. Типичное отношение многие ко многим. В таком варианте отзывы приходилось бы постоянно собирать по нескольким таблицам. 

Попробуем сделать первое приближение.

Если брать в расчёт статистику чтения/изменения списка отзывов к товару, то, очевидно, наиболее производительным вариантом является хранение списка отзывов в документоориентированной БД наподобие MongoDB "рядом" с идентификатором продукта и рядом с идентификатором пользователя. Получим 2 копии данных, и при редактировании/добавлении отзыва придется поработать с каждым из этих списков.

Можно хранить продукт с отзывами, а в профиле пользователя хранить ссылки на отзывы (аналог JOIN). Такой вариант мог бы быть вполне жизнеспособным с учетом нечастого запроса пользователями истории отзывов.

Однако отзывы к продуктам обычно оставляются конкретными пользователями, а в профиле мы хотим видеть не только сам отзыв, но и продукт, к которому этот отзыв был сделан. Поэтому в качестве решения хорошо подойдет денормализованная табличка вида (feedback_id, product_id, user_id), которая хотя и требует поиска в индексах, но упрощает редактирование и делает одинаково удобным и быстрым поиск отзывов пользователя и по продукту. 


Как альтернатива может быть рассмотрена графовая БД, где профили пользователей и продукты будут быстро возвращать ссылки на все отзывы. Однако отсутствие в постановке запросов, которые требовали бы обработки более глубоких связей, чем "найди отзывы пользователя" и "найди отзывы по продукту" не принесло бы желаемого роста производительности.
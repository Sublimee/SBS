**Пример "Фиксация оффера-победителя в розыгрыше для заданного периода"**

**Логический дизайн**

1. Создание операции аудита. Если при создании операции аудита возникла ошибка, то требуется отправить пользователю сообщение о невозможности зафиксировать оффер-победитель.

2. Проверка условий, которые являются пререквизитом для фиксации оффера-победителя:

   1) пользователю доступна программа "Колесо фортуны" в указанном периоде;
   2) пользователь еще не зафиксировал оффер-победитель в указанном периоде;
   3) оффер-победитель был предварительно сгенерирован для пользователя и сохранен в системе;
   4) присланный пользователем оффер-победитель совпадает с оффером победителем, сохраненным в системе.

   Если при проверке условий возникла ошибка или какое-либо условие не удовлетворено, то требуется:

   1) перевести операцию аудита в статус "Ошибка валидации";
   2) ответить пользователю сообщением о невозможности зафиксировать оффер-победитель.
   
3. Перевод операции аудита в статус "В процессе". Если при обновлении статуса операции аудита возникла ошибка, то требуется:

   1) перевести операцию аудита в статус "Ошибка";
   2) ответить пользователю сообщением о невозможности зафиксировать оффер-победитель.

4. Перевод операции аудита в статус "Успех". Если при обновлении статуса операции аудита возникла ошибка, то требуется:

   1) перевести операцию аудита в статус "Ошибка";
   2) ответить пользователю сообщением о невозможности зафиксировать оффер-победитель.

5. Фиксация оффера-победителя. Если при фиксации возникла ошибка, то требуется:

   1) перевести операцию аудита в статус "Ошибка";
   2) ответить пользователю сообщением о невозможности зафиксировать оффер-победитель.

**Соответствие кода логическому дизайну**

Код логическому дизайну не соответствует:
   1) ошибки при создании и обновлении статуса операции аудита игнорируются
   2) при ошибках валидации операция аудита переводится в статус "Ошибка", а не "Ошибка валидации"
   3) фиксация оффера-победителя происходит перед переводом операции аудита в статус "Успех"
   4) проверка условий в коде реализована близко к логическому дизайну, но может быть уточнена

Анализируемый код в принципе делал не то что нужно: для операции фиксации оффера-победителя не всегда создавалась операция аудита, а если и создавалась, то проходила не по тем статусам конечного автомата. Это было следствием плохо проведенного аналитиком анализа требований. Так как прохождение операции аудита по статусам в конечном автомате не валидируется, то такая реализация работала. 

В соответствие с проведенным анализом код был переписан, благодаря чему:
1) удалось достичь соответствия кода 1:1 с дизайном
2) удалось достичь бОльшей ясности и выразительности кода

Видим, что получившийся код по логическому дизайну близок к примеру 1. Напрашивается создание абстрактного класса,
который и будет объединять общие части этих двух примеров ().